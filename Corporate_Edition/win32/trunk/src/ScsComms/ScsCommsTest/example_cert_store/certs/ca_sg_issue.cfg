#
# ca_sg_issue.cfg
#
# OpenSSL configuration file for issuing Symantec AntiVirus
# and Symantec Client Security Login CA certificates and
# Server certificates off of a Server Group root CA certificate.
#

#
# Command lines:
#
# Login CA : openssl ca -config ./certs/ca_sg_issue.cfg -name scs_login_ca -in ./cert-signing-requests/BUGSBUNNY.00112233445566778899AABBCCDDEEFF.0.loginca.csr -out ./certs/BUGSBUNNY.00112233445566778899AABBCCDDEEFF.0.loginca.cer -batch -notext
# Server   : openssl ca -config ./certs/ca_sg_issue.cfg -name scs_server -in ./cert-signing-requests/BUGSBUNNY.00112233445566778899AABBCCDDEEFF.0.server.csr -out ./certs/BUGSBUNNY.00112233445566778899AABBCCDDEEFF.0.server.cer -batch -notext
#
# Login CA using x509 cmd (doesn't work): openssl x509 -req -inform DER -in ./cert-signing-requests/BUGSBUNNY.00112233445566778899AABBCCDDEEFF.0.loginca.csr -out ./certs/BUGSBUNNY.00112233445566778899AABBCCDDEEFF.0.loginca.cer -outform DER -days 1825 -CA ./certs/00112233445566778899AABBCCDDEEFF.0.server.cer -CAform DER -CAkey ./private-keys/00112233445566778899AABBCCDDEEFF.0.server.pvk -CAkeyform DER -CAserial ./certs/ca_sg_login_serial.dat -CAcreateserial -extfile ./certs/ca_sg_issue.cfg -extensions scs_login_ca_extensions
#

# We need to produce some random data from which to generate crypto data
# RANDFILE               = ./.rnd

####################################################################

[ ca ]

# no default section, because it should be specified on the command line

[ scs_login_ca ]

dir                    = ./certs
certificate            = ./certs/00112233445566778899AABBCCDDEEFF.0.servergroupca.cer
database               = ./certs/login_ca/index.txt
new_certs_dir          = ./certs/login_ca
private_key            = ./private-keys/00112233445566778899AABBCCDDEEFF.0.servergroupca.pvk
serial                 = ./certs/login_ca/serial.dat
unique_subject         = no

default_md             = sha1
default_days           = 1825 # 5 years for now
preserve               = yes  # preserve DN ordering from request
copy_extensions        = copy # copy any x509 extensions from request that are not explicitly defined in our ca policy

policy                 = scs_login_ca_policy
x509_extensions        = scs_login_ca_extensions

[ scs_login_ca_policy ]

commonName             = supplied
organizationalUnitName = supplied

[ scs_login_ca_extensions ]

nsComment              = "Symantec Client Security Login CA certificate generated with OpenSSL"
basicConstraints       = critical,CA:true,pathlen:0   # cert generated by this request can be used as a CA, but may not issue CAs
keyUsage               = cRLSign, keyCertSign
authorityKeyIdentifier = keyid:always

[ scs_server ]

dir                    = ./certs
certificate            = ./certs/00112233445566778899AABBCCDDEEFF.0.servergroupca.cer
database               = ./certs/server/index.txt
new_certs_dir          = ./certs/server
private_key            = ./private-keys/00112233445566778899AABBCCDDEEFF.0.servergroupca.pvk
serial                 = ./certs/server/serial.dat
unique_subject         = no

default_md             = sha1
default_days           = 1825 # 5 years for now
preserve               = yes  # preserve DN ordering from request
copy_extensions        = copy # copy any x509 extensions from request that are not explicitly defined in our ca policy

policy                 = scs_server_policy
x509_extensions        = scs_server_extensions

[ scs_server_policy ]

commonName             = supplied
organizationalUnitName = supplied

[ scs_server_extensions ]

nsComment              = "Symantec Client Security Server certificate generated with OpenSSL"
basicConstraints       = critical,CA:false                     # cert generated by this request cannot be used as a CA
keyUsage               = nonRepudiation, digitalSignature, keyEncipherment
authorityKeyIdentifier = keyid:always
# subjectAltName         = URI:roles://server # actual implementation should enforce this, but not clobber the DNS entry
